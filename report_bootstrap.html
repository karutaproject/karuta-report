<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
<script src="/karuta-core/other/js/jquery-1.10.2.min.js"></script>
<script src="/karuta-core/other/js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="/karuta-core/other/bootstrap/js/bootstrap.min.js"></script>
<script src="/karuta-core/other/colorpicker/js/evol.colorpicker.min.js"></script>
<script src="/karuta-core/other/oembed/jquery.oembed.js"></script>
<script src="/karuta-ed/application/js/_init.js"></script>
<script src="/karuta-core/other/js/js.cookie.js"></script>
<script src="/karuta-core/karuta/js/karuta.js"></script>
<script src="/karuta-core/karuta/js/report.js"></script>
<script src="/karuta-core/karuta/js/resources/Type_Color.js"></script>
<script src="/karuta-core/karuta/js/resources/Type_Image.js"></script>
<script src="/karuta-core/karuta/js/resources/Type_Field.js"></script>
<script src="/karuta-core/karuta/js/resources/Type_URL.js"></script>
<script src="/karuta-core/karuta/js/resources/Type_Document.js"></script>
<script src="/karuta-core/karuta/js/resources/Type_TextField.js"></script>
<script src="/karuta-core/karuta/js/model/Type_Portfolio.js"></script>
<script src="/karuta-core/karuta/js/resources/Type_Dashboard.js"></script>
<script src="/karuta-core/karuta/js/model/Type_Node.js"></script>
<script src="/karuta-core/karuta/js/model/Type_User.js"></script>
<script src="/karuta-core/karuta/js/UICom.js"></script>
<script>
loadLanguages(getLanguage);
//getLanguage();

var display = function(uuid, dashuuid)
{
	var depth = 1;
	var edit = true;
	var langcode = 0;
	var cb = function(data){
		UICom.parseStructure(data, true, uuid);
		if( dashuuid == null ) {
			// Find dashboard
			var dashboards = $('metadata[semantictag="Dashboard"]', data);
			var contenu = $('#contenu', document);
			// List them
			for( var i=0; i<dashboards.length; ++i ) {
				var dashid = $(dashboards[i]).parent().attr('id');
				$(contenu).append('<p>'+dashid+'</p>')
			}
		}
		else {
			UIFactory['Node'].displayStandard(UICom.structure['tree'][dashuuid],'contenu',depth,langcode,edit);
		}
	};
	$.ajax({
		type: "GET",
		url: "/"+serverBCK+"/portfolios/portfolio/"+uuid+"?resources=true",
		success: cb,
	});
};

var cb_start = function(data)
{
	// Needed parameter: code, find which portfolio id from it
	// Check list parameter, if exist, show uuid list
	// If uuid given, display asked one
	var q = window.location.search.slice(1).split('#')[0];
	var arr = q.split('&');
	var params = {};
	for(var i=0; i<arr.length; ++i){
		var a = arr[i].split('=');
		params[a[0]] = a[1];
	}


	USER = new UIFactory["User"]($("user",data));

	var uuid = params['uuid'];
	var dashid = params['dashid'];
	display(uuid, dashid);
};

$.ajax({
	type : "GET",
	dataType : "xml",
	url : "/"+serverBCK+"/credential",
	data: "",
	success : cb_start,
});
</script>


</head>
<body>
<div id="contenu"></div></body>
<div id="alert-window-footer" class="model-footer"></div>
</html>
